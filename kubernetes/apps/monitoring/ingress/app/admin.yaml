apiVersion: external-secrets.io/v1
kind: ExternalSecret
metadata:
  name: metrics-admin-token
  namespace: monitoring
spec:
  secretStoreRef:
    name: tf-prod
    kind: ClusterSecretStore
  data:
    - secretKey: token
      remoteRef:
        key: METRICS_ADMIN_TOKEN
---
apiVersion: operator.victoriametrics.com/v1beta1
kind: VMUser
metadata:
  name: metrics-admin
  namespace: monitoring
  labels:
    vm-user: "admin"
spec:
  tokenRef:
    name: metrics-admin-token
    key: token
  targetRefs:
    - crd:
        kind: VMSingle
        name: vmetrics
        namespace: monitoring
      paths: ["/api/v1/admin.*"]
